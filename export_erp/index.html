<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Factory ERP AI</title>

<style>
:root{
 --bg:#0b1324;
 --card:#1f2a3a;
 --user:#2563eb;
 --bot:#36485c;
 --accent:#22c55e;
}

body{
 margin:0;
 font-family:Segoe UI;
 background:linear-gradient(180deg,#0b1324,#0e1a2f);
 color:white;
 height:100vh;
 height:100dvh;
 display:flex;
 flex-direction:column;
 overflow:hidden;
}

header{
 position:fixed;
 top:0;
 left:0;
 width:100%;
 background:#1e293b;
 padding:16px;
 text-align:center;
 font-weight:bold;
 font-size:20px;
 z-index:1000;
 box-shadow:0 4px 12px rgba(0,0,0,.4);
}

#printBtn{
 position:absolute;
 right:20px;
 top:14px;
 background:#22c55e;
 border:none;
 padding:6px 14px;
 border-radius:20px;
 font-size:13px;
 font-weight:bold;
 cursor:pointer;
}

#chat{
 margin-top:75px;
 flex:1;
 overflow-y:auto;
 padding:18px;
 padding-bottom:170px;
 display:flex;
 flex-direction:column;
 gap:14px;
}

.msg{
 max-width:88%;
 padding:16px 18px;
 border-radius:18px;
 line-height:1.5;
 font-size:15px;
 box-shadow:0 6px 18px rgba(0,0,0,.35);
 animation:fadeIn .2s ease-in-out;
}

@keyframes fadeIn{
 from{opacity:0; transform:translateY(5px);}
 to{opacity:1; transform:translateY(0);}
}

.user{
 align-self:flex-end;
 background:linear-gradient(135deg,#2563eb,#3b82f6);
}

.bot{
 align-self:flex-start;
 background:var(--bot);
 border:1px solid #475569;
}

/* ‚úÖ ADD REPORT IDENTIFIER */
.report-msg{
 border-left:4px solid #22c55e;
}

/* ‚úÖ PRINT CONTROL SYSTEM */
@media print{

 body{
  background:white !important;
  color:black !important;
 }

 header, footer, #quickBar, #suggestions{
  display:none !important;
 }

 .user{
  display:none !important;
 }

 .bot{
  display:none !important;
 }

 .report-msg:last-of-type{
  display:block !important;
  background:white !important;
  color:black !important;
  border:none !important;
  box-shadow:none !important;
  font-size:14px !important;
  line-height:1.7 !important;
 }

 #chat{
  margin:0;
  padding:0;
 }

 @page{
  size:A4 portrait;
  margin:15mm;
 }
}
 </style>
</head>

<body>

<header>
üè≠ 34" Factory ERP AI
<button id="printBtn" onclick="printChat()">Print</button>
</header>

<div id="chat">
<div class="msg bot">
‡¶ì‡¶∏‡ßç‡¶§‡¶æ‡¶¶, ‡¶∏‡¶ø‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¨‡¶æ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§
</div>
</div>

<div id="suggestions"></div>

<div id="quickBar">
<span class="quick-btn" onclick="quick('totall')">totall</span>
<span class="quick-btn" onclick="quick('today')">today</span>
<span class="quick-btn" onclick="quick('cpb per day')">cpb per day</span>
<span class="quick-btn" onclick="quick('jigger per day')">jigger per day</span>
<span class="quick-btn" onclick="quick('sill 590')">sill 590</span>
</div>

<footer>
<input id="q" placeholder="Type command...">
<button onclick="send()">Send</button>
</footer>
<script>
var chat=document.getElementById("chat");
var input=document.getElementById("q");
var suggestions=document.getElementById("suggestions");
var lastUserQuery = "";

var commands=[
"totall","today",
"cpb per day","jigger per day",
"napthol per day","singing per day",
"marcerise per day","bleach per day"
];

function add(text,type){
 var d=document.createElement("div");

 /* ‚úÖ REPORT IDENTIFY */
 if(type==="bot"){
   d.className="msg bot report-msg";
 }else{
   d.className="msg "+type;
 }

 text=text.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>');
 text=text.replace(/\n/g,"<br>");

 d.innerHTML=text;
 chat.appendChild(d);
 chat.scrollTop=chat.scrollHeight;
}

function send(){
 var text=input.value.trim();
 if(text==="") return;

 add(text,"user");
 lastUserQuery = text;

 input.value="";
 suggestions.style.display="none";

 fetch("/export/api/ask",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({question:text})
 })
 .then(res=>res.json())
 .then(data=>{
  add(data.reply,"bot");
 })
 .catch(()=>{
  add("‚ö†Ô∏è Server error","bot");
 });
}

function quick(t){
 input.value=t;
 send();
}

input.addEventListener("input",function(){
 var value=this.value.toLowerCase();
 suggestions.innerHTML="";
 if(value===""){ suggestions.style.display="none"; return; }

 var list=[];
 for(var i=0;i<commands.length;i++){
  if(commands[i].indexOf(value)!==-1){
   list.push(commands[i]);
  }
 }

 if(list.length===0){
  suggestions.style.display="none";
  return;
 }

 for(var j=0;j<list.length;j++){
  var div=document.createElement("div");
  div.className="suggest-item";
  div.innerText=list[j];
  div.onclick=function(){
   input.value=this.innerText;
   suggestions.style.display="none";
   input.focus();
  };
  suggestions.appendChild(div);
 }

 suggestions.style.display="block";
}

/* ‚úÖ CORPORATE PRINT FUNCTION */
function printChat(){

 var reports=document.querySelectorAll(".report-msg");

 if(reports.length===0){
   alert("No report to print");
   return;
 }

 var lastReport=reports[reports.length-1].innerHTML;
 var now=new Date();
 var dateTime=now.toLocaleString();

 var win=window.open("","","width=900,height=700");

 win.document.write(`
  <html>
  <head>
   <title>Production Report</title>
   <style>
    body{font-family:Arial;padding:40px;}
    .company{font-size:30px;font-weight:bold;text-align:center;}
    .address{text-align:center;font-size:14px;margin-top:5px;}
    .title{text-align:center;font-size:18px;font-weight:bold;margin-top:10px;}
    .meta{margin-top:15px;font-size:14px;}
    .footer{margin-top:50px;font-size:13px;display:flex;justify-content:space-between;}
    @page{size:A4 portrait;margin:15mm;}
   </style>
  </head>
  <body>

   <div class="company">
     Sukhy Dyeing & Finishing Mills Ltd.
   </div>

   <div class="address">
     Kurerpar, Sekherchor, Narsingdi.
   </div>

   <div class="title">
     34" Production Report
   </div>

   <div class="meta">
     <b>Generated:</b> ${dateTime}
   </div>

   <hr>

   ${lastReport}

   <div class="footer">
     <div>
       Prepared By: Mehedi Hasan<br>
       Developed By: Mehedi Hasan
     </div>
     <div>
       Signature: ________________________
     </div>
   </div>

  </body>
  </html>
 `);

 win.document.close();
 win.print();
}
</script>

</body>
</html>
