<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Factory ERP AI</title>

<style>
:root{
 --bg:#0b1324;
 --card:#1f2a3a;
 --user:#2563eb;
 --bot:#36485c;
 --accent:#22c55e;
}

body{
 margin:0;
 font-family:Segoe UI;
 background:linear-gradient(180deg,#0b1324,#0e1a2f);
 color:white;
 height:100vh;
 height:100dvh;
 display:flex;
 flex-direction:column;
 overflow:hidden;
}

header{
 position:fixed;
 top:0;
 left:0;
 width:100%;
 background:#1e293b;
 padding:16px;
 text-align:center;
 font-weight:bold;
 font-size:20px;
 z-index:1000;
 box-shadow:0 4px 12px rgba(0,0,0,.4);
}

#printBtn{
 position:absolute;
 right:20px;
 top:14px;
 background:#22c55e;
 border:none;
 padding:6px 14px;
 border-radius:20px;
 font-size:13px;
 font-weight:bold;
 cursor:pointer;
}

#chat{
 margin-top:75px;
 flex:1;
 overflow-y:auto;
 padding:18px;
 padding-bottom:170px;
 display:flex;
 flex-direction:column;
 gap:14px;
}

.msg{
 max-width:88%;
 padding:16px 18px;
 border-radius:18px;
 line-height:1.5;
 font-size:15px;
 box-shadow:0 6px 18px rgba(0,0,0,.35);
 animation:fadeIn .2s ease-in-out;
}

@keyframes fadeIn{
 from{opacity:0; transform:translateY(5px);}
 to{opacity:1; transform:translateY(0);}
}

.user{
 align-self:flex-end;
 background:linear-gradient(135deg,#2563eb,#3b82f6);
}

.bot{
 align-self:flex-start;
 background:var(--bot);
 border:1px solid #475569;
}

#suggestions{
 position:fixed;
 bottom:95px;
 left:15px;
 right:15px;
 background:#1e293b;
 border-radius:14px;
 border:1px solid #334155;
 display:none;
 max-height:220px;
 overflow-y:auto;
 z-index:999;
 box-shadow:0 10px 25px rgba(0,0,0,.5);
}

.suggest-item{
 padding:12px;
 border-bottom:1px solid #334155;
 cursor:pointer;
 transition:.2s;
}

.suggest-item:last-child{
 border-bottom:none;
}

.suggest-item:hover{
 background:#334155;
}

#quickBar{
 position:fixed;
 bottom:65px;
 left:0;
 width:100%;
 overflow-x:auto;
 white-space:nowrap;
 padding:8px 12px;
}

.quick-btn{
 display:inline-block;
 background:#1e293b;
 padding:7px 16px;
 border-radius:25px;
 margin-right:10px;
 font-size:14px;
 cursor:pointer;
 transition:.2s;
}

.quick-btn:hover{
 background:#334155;
}

footer{
 position:fixed;
 bottom:0;
 left:0;
 width:100%;
 background:#1e293b;
 padding:12px;
 display:flex;
 gap:10px;
 box-shadow:0 -4px 12px rgba(0,0,0,.4);
}

input{
 flex:1;
 padding:14px;
 border-radius:30px;
 border:none;
 outline:none;
 font-size:16px;
 background:#0f172a;
 color:white;
}

button{
 padding:12px 20px;
 border:none;
 border-radius:30px;
 background:var(--accent);
 font-weight:bold;
 cursor:pointer;
 transition:.2s;
}

button:hover{
 opacity:.85;
}
</style>
</head>

<body>

<header>
üè≠ 34" Factory ERP AI
<button id="printBtn" onclick="printChat()">Print</button>
</header>

<div id="chat">
<div class="msg bot">
‡¶ì‡¶∏‡ßç‡¶§‡¶æ‡¶¶, ‡¶∏‡¶ø‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¨‡¶æ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§
</div>
</div>

<div id="suggestions"></div>

<div id="quickBar">
<span class="quick-btn" onclick="quick('totall')">totall</span>
<span class="quick-btn" onclick="quick('today')">today</span>
<span class="quick-btn" onclick="quick('cpb per day')">cpb per day</span>
<span class="quick-btn" onclick="quick('jigger per day')">jigger per day</span>
<span class="quick-btn" onclick="quick('sill 590')">sill 590</span>
</div>

<footer>
<input id="q" placeholder="Type command...">
<button onclick="send()">Send</button>
</footer>

<script>
var chat=document.getElementById("chat");
var input=document.getElementById("q");
var suggestions=document.getElementById("suggestions");

var commands=[
"totall","today",
"cpb per day","jigger per day",
"napthol per day","singing per day",
"marcerise per day","bleach per day"
];

function add(text,type){
 var d=document.createElement("div");
 d.className="msg "+type;

 text=text.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>');
 text=text.replace(/\n/g,"<br>");

 d.innerHTML=text;
 chat.appendChild(d);
 chat.scrollTop=chat.scrollHeight;
}

function send(){
 var text=input.value.trim();
 if(text==="") return;

 add(text,"user");
 input.value="";
 suggestions.style.display="none";

 fetch("/export/api/ask",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({question:text})
 })
 .then(function(res){return res.json();})
 .then(function(data){
  add(data.reply,"bot");
 })
 .catch(function(){
  add("‚ö†Ô∏è Server error","bot");
 });
}

function quick(t){
 input.value=t;
 send();
}

input.addEventListener("input",function(){
 var value=this.value.toLowerCase();
 suggestions.innerHTML="";

 if(value===""){
  suggestions.style.display="none";
  return;
 }

 var list=[];
 for(var i=0;i<commands.length;i++){
  if(commands[i].indexOf(value)!==-1){
   list.push(commands[i]);
  }
 }

 if(list.length===0){
  suggestions.style.display="none";
  return;
 }

 for(var j=0;j<list.length;j++){
  var div=document.createElement("div");
  div.className="suggest-item";
  div.innerText=list[j];
  div.onclick=function(){
   input.value=this.innerText;
   suggestions.style.display="none";
   input.focus();
  };
  suggestions.appendChild(div);
 }

 suggestions.style.display="block";
});

/* ===== ISO STYLE PRINT FUNCTION ===== */
function printChat(){

 var messages=document.querySelectorAll(".bot");
 var content="";

 messages.forEach(function(msg){
  content+=`<div style="margin-bottom:10px;">${msg.innerHTML}</div>`;
 });

 var today=new Date();
 var dateTime=today.toLocaleString();

 var win=window.open("","","width=900,height=700");

 win.document.write(`
  <html>
  <head>
   <title>ISO ERP Report</title>
   <style>
    body{font-family:Arial;padding:40px;}
    .header{text-align:center;margin-bottom:20px;}
    .company{font-size:24px;font-weight:bold;letter-spacing:1px;}
    .address{font-size:14px;color:#555;margin-top:4px;}
    .erp{font-size:16px;font-weight:bold;margin-top:6px;}
    .line{height:2px;background:#000;width:70%;margin:15px auto;}
    .meta{margin-top:10px;}
    .footer{margin-top:40px;font-size:12px;display:flex;justify-content:space-between;}
   </style>
  </head>
  <body>

   <div class="header">
     <div class="company">Sukhy Dyeing and Finishing Mills LTD.</div>
     <div class="address">Kurerpar, Shekherchor, Narsingdi.</div>
     <div class="erp">Sukhy ERP</div>
     <div class="line"></div>
   </div>

   <div class="meta">
  <div style="font-size:18px;font-weight:bold;margin-bottom:6px;">
    34" Fabric Dyeing Report
  </div>
  <b>Query:</b> ${lastUserQuery || "Custom Command"}<br>
  <b>Generated:</b> ${dateTime}
</div>

   <hr>

   ${content}

   <div class="footer">
     <div>
       Prepared By: Mehedi Hasan <br>
       Developed By: Mehedi Hasan
     </div>
     <div>
       Signature: ___________________________
     </div>
   </div>

  </body>
  </html>
 `);

 win.document.close();
 win.print();
}
</script>

</body>
</html>
